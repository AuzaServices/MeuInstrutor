<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Painel de Administração</title>
  <link rel="stylesheet" href="admin.css">
</head>
<body>
  <header class="topo">
    <h1>Painel de Administração</h1>
  </header>

  <main>
    <!-- Lista de instrutores pendentes -->
    <section class="lista-instrutores">
      <h2>Solicitações Pendentes</h2>
      <table>
        <thead>
          <tr>
            <th>Nome Completo</th>
            <th>CPF</th>
            <th>Endereço</th>
            <th>Cidade</th>
            <th>Estado</th>
            <th>Telefone</th>
            <th>Comprovante</th>
            <th>CNH</th>
            <th>Categoria</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="tabelaPendentes">
          <!-- Preenchido via JS -->
        </tbody>
      </table>
    </section>

    <!-- Lista de instrutores aceitos -->
    <section class="lista-instrutores">
      <h2>Instrutores Aceitos</h2>
      <table>
        <thead>
          <tr>
            <th>Nome Completo</th>
            <th>CPF</th>
            <th>Endereço</th>
            <th>Cidade</th>
            <th>Estado</th>
            <th>Telefone</th>
            <th>Comprovante</th>
            <th>CNH</th>
            <th>Categoria</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody id="tabelaAceitos">
          <!-- Preenchido via JS -->
        </tbody>
      </table>
    </section>
  </main>

  <script>
async function carregarInstrutores() {
  const resposta = await fetch("https://meuinstrutor.onrender.com/instrutores/todos");
  const instrutores = await resposta.json();

  const tabelaPendentes = document.getElementById("tabelaPendentes");
  const tabelaAceitos = document.getElementById("tabelaAceitos");
  tabelaPendentes.innerHTML = "";
  tabelaAceitos.innerHTML = "";

  instrutores.forEach(instrutor => {
    if (instrutor.status === "aceito") {
      tabelaAceitos.innerHTML += `
        <tr>
          <td>${instrutor.nome}</td>
          <td>${instrutor.cpf}</td>
          <td>${instrutor.endereco}</td>
          <td>${instrutor.cidade}</td>
          <td>${instrutor.estado}</td>
          <td>${instrutor.telefone}</td>
          <td><img src="${instrutor.comprovante_residencia}" width="80"></td>
          <td><img src="${instrutor.cnh}" width="80"></td>
          <td>${instrutor.categorias}</td>
          <td style="color:green; font-weight:bold;">✔ Aceito</td>
          <td><button class="excluir" data-id="${instrutor.id}">Excluir</button></td>
        </tr>
      `;
    } else {
      tabelaPendentes.innerHTML += `
        <tr>
          <td>${instrutor.nome}</td>
          <td>${instrutor.cpf}</td>
          <td>${instrutor.endereco}</td>
          <td>${instrutor.cidade}</td>
          <td>${instrutor.estado}</td>
          <td>${instrutor.telefone}</td>
          <td><img src="${instrutor.comprovante_residencia}" width="80"></td>
          <td><img src="${instrutor.cnh}" width="80"></td>
          <td>${instrutor.categorias}</td>
          <td>
            <button class="admitir" data-id="${instrutor.id}">Aceitar</button>
            <button class="excluir" data-id="${instrutor.id}">Recusar</button>
          </td>
        </tr>
      `;
    }
  });
}

    document.addEventListener("DOMContentLoaded", () => {
      const tabela = document.querySelector("main");

      tabela.addEventListener("click", async (e) => {
        if (e.target.classList.contains("admitir")) {
          const id = e.target.dataset.id;
          const resposta = await fetch(`https://meuinstrutor.onrender.com/instrutores/aceitar/${id}`, { method: "PUT" });
          const resultado = await resposta.json();
          alert(resultado.message);
          carregarInstrutores();
        }

        if (e.target.classList.contains("excluir")) {
          const id = e.target.dataset.id;
          const resposta = await fetch(`https://meuinstrutor.onrender.com/instrutores/${id}`, { method: "DELETE" });
          const resultado = await resposta.json();
          alert(resultado.message);
          carregarInstrutores();
        }
      });

      carregarInstrutores();
    });
  </script>
</body>
</html>