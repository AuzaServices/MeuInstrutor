<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Achei Instrutor</title>

  <!-- Seu CSS -->
  <link rel="stylesheet" href="style.css" />

  <!-- Biblioteca AOS -->
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

  <!-- Font Awesome (apenas uma vez, vers√£o mais recente) -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <link rel="icon" type="image/png" href="logo.png" />

</head>
<body>
  <!-- Cabe√ßalho -->
  <header class="topo">
    <div class="logo">
      <img src="logo.png" alt="Achei Instrutor" />
      <span>Achei Instrutor</span>
    </div>
    <button class="menu-toggle">‚ò∞</button>
    <nav class="menu">
      <a href="index.html">In√≠cio</a>
      <a href="sobre.html">Sobre n√≥s</a>
      <a href="contato.html">Fale Conosco</a>
      <button class="btn amarelo" id="btnInstrutor">Sou Instrutor</button>
    </nav> 
  </header>

  <!-- Se√ß√£o principal -->
<!-- Sess√£o de busca -->
<!-- Section do formul√°rio -->
<section class="fundo-busca" data-aos="fade-up">
  <div class="form-bloco">
    <div class="imagem"></div>
    <div class="formulario">
      <h2 id="titulo-form">Buscar Instrutor Credenciado</h2>
      <div id="form-area"></div>
    </div>
  </div>
</section>

<!-- Section dos resultados (separada, logo abaixo) -->
<section class="fundo-resultados" data-aos="fade-up">
<div class="resultado-bloco">
  <h4 id="filtro-info"></h4>
  <p id="filtro-aplicado"></p>

  <!-- Mobile: carrossel -->
  <section id="resultado-mobile"></section>

  <!-- Desktop: grid -->
  <section id="resultado-desktop"></section>
</div>
</section>


<h2 style="text-align:center; margin-bottom:10px; font-size:22px; font-weight:600; color:#333;">
  Saiba o que muda na forma√ß√£o de novos motoristas
</h2>

<div class="video-container">
  <iframe 
    src="https://www.youtube.com/embed/MQsEbHDy9O8"
    title="Contran aprova fim de aulas obrigat√≥rias em autoescolas"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
    allowfullscreen>
  </iframe>
</div>

<style>
  .video-container {
    width: 100%;        
    margin: 30px auto;   /* menos espa√ßo em cima/baixo */
    max-width: 900px;    /* limite no desktop para n√£o ocupar toda a tela */
  }

  .video-container iframe {
    width: 100%;
    height: 360px;       /* altura ajustada no desktop */
    border-radius: 8px;
    border: none;
    display: block;
  }

  @media (max-width: 768px) {
    .video-container iframe {
      height: 240px;     /* altura menor s√≥ no mobile */
    }
  }
</style>


<!-- Sess√£o: Como funciona -->
<section class="como-funciona" data-aos="fade-right">
  <h2>Como Funciona</h2>
  <p>
    O Achei Instrutor conecta pessoas que desejam aprender a dirigir com instrutores credenciados
    em sua regi√£o. Basta selecionar estado, cidade, categoria da CNH e prefer√™ncia de g√™nero
    para encontrar rapidamente profissionais dispon√≠veis. Nosso objetivo √© simplificar o processo
    e dar autonomia ao aluno para escolher quem vai acompanh√°-lo nas aulas pr√°ticas.
  </p>
</section>

<!-- Sess√£o: Nossa Miss√£o -->
<section class="missao" data-aos="zoom-in">
  <h2>Nossa Miss√£o</h2>
  <p>
    Servimos como ponte entre candidatos √† CNH e instrutores credenciados, sejam homens ou mulheres.
    Acreditamos que todos merecem acesso a profissionais qualificados, com transpar√™ncia e seguran√ßa.
    Nossa miss√£o √© democratizar o acesso ao ensino de dire√ß√£o, oferecendo praticidade e confian√ßa
    na escolha do instrutor.
  </p>
</section>

<!-- Sess√£o: Requisitos para ser Instrutor -->
<section class="requisitos" data-aos="fade-left">
  <h2>Requisitos para ser Instrutor Credenciado</h2>
  <p>
    Para atuar como instrutor de tr√¢nsito aut√¥nomo no Brasil, √© necess√°rio cumprir alguns requisitos
    estabelecidos pelo Contran e pelo Detran:
  </p>
  <ul>
    <li>Ter no m√≠nimo <strong>21 anos de idade</strong>.</li>
    <li>Possuir <strong>CNH v√°lida</strong> na categoria que deseja ensinar, h√° pelo menos 2 anos.</li>
    <li>N√£o ter cometido infra√ß√µes graves ou grav√≠ssimas nos √∫ltimos 12 meses.</li>
    <li>Concluir um <strong>curso espec√≠fico de forma√ß√£o de instrutor</strong>, com conte√∫do pedag√≥gico,
        t√©cnico e pr√°tico sobre legisla√ß√£o de tr√¢nsito e condu√ß√£o respons√°vel.</li>
    <li>Ser cadastrado e autorizado pelo <strong>Detran</strong> do estado de atua√ß√£o.</li>
  </ul>
  <p>
    Esses crit√©rios garantem que apenas profissionais qualificados possam oferecer aulas pr√°ticas,
    assegurando a seguran√ßa e a qualidade do processo de forma√ß√£o de novos condutores.
  </p>
</section>

<!-- Sess√£o: Transpar√™ncia e Valores -->
<section class="transparencia" data-aos="flip-up">
  <h2>Transpar√™ncia e Valores</h2>
  <p>
    No Achei Instrutor, prezamos pela transpar√™ncia em todas as etapas. O instrutor tem total liberdade
    para definir o valor que deseja cobrar por aula. A plataforma n√£o interfere na negocia√ß√£o entre
    cliente e instrutor no quesito de valores.
  </p>
  <p>
    Para se manter vis√≠vel na plataforma, √© cobrada apenas uma taxa simb√≥lica de <strong>R$ 14,99 por m√™s</strong>.
    Todo o dinheiro arrecadado pelo instrutor durante o m√™s √© <strong>100% dele</strong>, sem qualquer reten√ß√£o
    ou comiss√£o por parte da plataforma.
  </p>
  <p>
    Ap√≥s o cadastro e envio dos documentos, nossa equipe leva em torno de <strong>24 horas</strong> para analisar
    e verificar se est√° tudo de acordo. Logo ap√≥s a aprova√ß√£o, a empresa entrar√° em contato solicitando
    o pagamento da taxa mensal de R$ 14,99. Com o pagamento confirmado, o instrutor passa a aparecer
    nos filtros da cidade em que foi cadastrado, tornando-se vis√≠vel para os alunos que buscam
    profissionais credenciados.
  </p>
</section>

<!-- Sess√£o: Conex√µes e Informa√ß√µes -->
<!-- Sess√£o: Redes sociais e pol√≠ticas -->
<!-- Sess√£o Institucional / Contato -->
<section id="contato" class="institucional-section scroll-reveal">
  <div class="institucional-grid">
    
    <!-- Coluna 1: Logo e informa√ß√µes -->
    <div class="institucional-col">
      <img src="logo.png" alt="Logo Achei Instrutor" class="institucional-logo" />
      <p>Achei Instrutor √© a plataforma que conecta alunos a instrutores credenciados de forma pr√°tica, segura e transparente.</p>
    </div>

    <!-- Coluna 2: Menu r√°pido -->
    <div class="institucional-col">
      <h4>Menu r√°pido</h4>
      <ul>
        <li><a href="#inicio">In√≠cio</a></li>
        <li><a href="#cadastro">Cadastro</a></li>
        <li><a href="#servicos">Servi√ßos</a></li>
        <li><a href="#faq">FAQ</a></li>
        <li><a href="#contato">Contato</a></li>
      </ul>
    </div>

    <!-- Coluna 3: Institucional -->
    <div class="institucional-col">
      <h4>Institucional</h4>
      <ul>
        <li><a href="/politica.html" target="_blank">Pol√≠tica de Privacidade</a></li>
        <li><a href="/termos.html" target="_blank">Termos de Uso</a></li>
      </ul>
    </div>
  </div>

  <!-- √çcones sociais -->
<div class="redes-sociais">
  <a href="https://wa.me/5585991340658" target="_blank" aria-label="WhatsApp">
    <i class="fa-brands fa-whatsapp"></i>
  </a>
  <a href="https://instagram.com/instrutorpro" target="_blank" aria-label="Instagram">
    <i class="fa-brands fa-instagram"></i>
  </a>
  <a href="https://twitter.com/instrutorpro" target="_blank" aria-label="X">
    <i class="fa-brands fa-x-twitter"></i>
  </a>
  <a href="https://facebook.com/instrutorpro" target="_blank" aria-label="Facebook">
    <i class="fa-brands fa-facebook"></i>
  </a>
</div>
</section>

<!-- Footer principal -->
<footer>
  ¬© 2025 Achei Instrutor - Todos os direitos reservados
</footer>

  <!-- Script -->
  <script>
    // Formul√°rio de aluno
    function carregarFormularioAluno() {
      document.getElementById("titulo-form").innerText = "Buscar Instrutor(a) Cred√™nciado(a)";
      document.getElementById("form-area").innerHTML = `
        <form onsubmit="buscarInstrutor(event)">
          <div class="linha-horizontal">
            <div class="campo">
              <label for="estado">Estado:</label>
              <select id="estado" required>
                <option value="">Selecione o estado</option>
              </select>
            </div>
            <div class="campo">
              <label for="cidade">Cidade:</label>
              <select id="cidade" required>
                <option value="">Selecione a cidade</option>
              </select>
            </div>
          </div>
          <div class="linha-horizontal">
            <div class="campo">
              <label for="categoria">Categoria CNH:</label>
              <select id="categoria" required>
                <option value="">Selecione a categoria</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
              </select>
            </div>
            <div class="campo">
              <label for="sexo">Sexo:</label>
<select id="sexo" name="sexo" required>
  <option value="">Selecione</option>
  <option value="feminino">Feminino</option>
  <option value="masculino">Masculino</option>
  <option value="sem-preferencia">Sem prefer√™ncia</option>
</select>
            </div>
          </div>
          <button type="submit">Buscar</button>

<p style="font-size: 12px; color: #555; margin-top: 8px;">
  Ao clicar em <strong>Buscar</strong>, voc√™ concorda com os 
  <a href="/termos.html" target="_blank" style="color: orange;">Termos de Uso</a> e com a 
  <a href="/politica.html" target="_blank" style="color: orange;">Pol√≠tica de Privacidade</a>.
</p>
        </form>
        <div id="resultado"></div>
      `;

      carregarEstadosAluno();
      document.getElementById("estado").addEventListener("change", carregarCidadesAluno);
    }

    

async function buscarInstrutor(event) {
  event.preventDefault();

  const estado = document.getElementById("estado").selectedOptions[0].text;
  const cidade = document.getElementById("cidade").value;
  const categoria = document.getElementById("categoria").value;
  const sexo = document.getElementById("sexo").value;

  try {
    const resposta = await fetch(
      `https://meuinstrutor.onrender.com/instrutores/aceitos?cidade=${cidade}&estado=${estado}&sexo=${sexo}&categorias=${categoria}`
    );

    if (!resposta.ok) {
      throw new Error(`Erro ${resposta.status}: ${resposta.statusText}`);
    }

    const data = await resposta.json();
    // garante que seja array
    const instrutores = Array.isArray(data) ? data : [];

    // Atualiza textos informativos
    document.getElementById("filtro-info").innerText =
      `Instrutores dispon√≠veis em ${cidade}/${estado}:`;
    document.getElementById("filtro-aplicado").innerText =
      `Filtro aplicado: Categoria ${categoria}, Sexo ${sexo}`;

    // Monta os cards ou mensagem de vazio
    let cardsHtml = "";

    if (instrutores.length === 0) {
      cardsHtml = `
        <div class="mensagem-vazia">
          <i class="fa-solid fa-magnifying-glass"></i>
          <p>Ainda n√£o foram cadastrados instrutores para sua busca</p>
        </div>
      `;
    } else {
      instrutores.forEach(instrutor => {
        const nomes = instrutor.nome ? instrutor.nome.split(" ") : [];
        const primeiroNome = nomes[0] || "";
        const segundoNome = nomes[1] || "";
        const telefone = instrutor.telefone ? instrutor.telefone.replace(/\D/g, "") : "";
        const linkWhats = telefone ? `https://wa.me/55${telefone}` : "#";
        const selfieUrl = instrutor.selfie || "https://res.cloudinary.com/dzwkr47ib/image/upload/v1234567890/placeholder.jpg";

        const totalAvaliacoes = instrutor.total_avaliacoes || 0;
        const mediaEstrelas = totalAvaliacoes > 0 ? Number(instrutor.media_estrelas) : 0;

        const estrelasInt = Math.round(mediaEstrelas);
        const estrelasHtml =
          "<span class='estrela cheia'>‚òÖ</span>".repeat(estrelasInt) +
          "<span class='estrela vazia'>‚òÜ</span>".repeat(5 - estrelasInt);

        cardsHtml += `
          <div class="card-instrutor">
            <img src="${selfieUrl}" alt="Foto de ${instrutor.nome}" class="foto-instrutor">
            <div class="conteudo">
              <h3>${primeiroNome} ${segundoNome}</h3>
              <p class="categorias">Categoria(s): ${instrutor.categorias || "N√£o informado"}</p>
              <p class="media-estrelas">
                ${estrelasHtml} <br>
                (${totalAvaliacoes} avalia√ß√µes)
              </p>
              <div class="acoes">
                <a href="${linkWhats}" target="_blank" rel="noopener noreferrer" class="btn-whatsapp">WhatsApp</a>
                <button class="btn-avaliar" data-id="${instrutor.id}" title="Avaliar">
                  <i class="fa-regular fa-comment"></i>
                </button>
              </div>
            </div>
          </div>
        `;
      });
    }

    // Injeta nos containers de resultado
    document.getElementById("resultado-mobile").innerHTML =
      `<div class="carousel-container">${cardsHtml}</div>`;
    document.getElementById("resultado-desktop").innerHTML =
      `<div class="cards-container">${cardsHtml}</div>`;

  } catch (erro) {
    console.error("‚ùå Erro ao buscar instrutores, clique novamente em Buscar:", erro);
    const erroHtml = `<div class="mensagem-vazia"><p>Erro ao carregar instrutores</p></div>`;
    document.getElementById("resultado-mobile").innerHTML = erroHtml;
    document.getElementById("resultado-desktop").innerHTML = erroHtml;
  }
}

function carregarFormularioInstrutor() {
  document.getElementById("titulo-form").innerText = "Cadastro de Instrutor";
  document.getElementById("form-area").innerHTML = `
    <form id="formInstrutor">
      
      <!-- Etapa 1: Dados pessoais -->
      <div class="etapa" id="etapa1">
        <label>Nome completo:</label>
        <input type="text" id="nome" required>

        <label>Email:</label>
        <input type="email" id="email" name="email" required>

        <label>CPF:</label>
        <input type="text" id="cpf" maxlength="14" required>

        <label>Sexo:</label>
        <select id="sexoInstrutor" required>
          <option value="">Selecione</option>
          <option value="M">Masculino</option>
          <option value="F">Feminino</option>
        </select>

        <label>Telefone (Whatsapp):</label>
        <input type="tel" id="telefone" name="telefone" placeholder="(XX)9XXXX-XXXX" title="Formato esperado: (XX)9XXXX-XXXX">

        <button type="button" onclick="validarEAvancar(1,2)">Pr√≥ximo</button>
      </div>

      <!-- Etapa 2: Endere√ßo -->
      <div class="etapa" id="etapa2" style="display:none;">
        <h4>Localiza√ß√£o</h4>
        
        <label>Estado:</label>
        <select id="estadoInstrutor" required>
          <option value="">Selecione o estado</option>
        </select>

        <label>Cidade:</label>
        <select id="cidadeInstrutor" required>
          <option value="">Selecione a cidade</option>
        </select>

        <button type="button" onclick="voltarEtapa(1)">Voltar</button>
        <button type="button" onclick="validarEAvancar(2,3)">Pr√≥ximo</button>
      </div>

      <!-- Etapa 3: Identifica√ß√£o Pessoal -->
      <div class="etapa" id="etapa3" style="display:none;">
        <h4>Identifica√ß√£o Pessoal</h4>

        <label for="selfie" class="custom-file-label">
          <i class="fa-solid fa-upload"></i> Carregar Foto do instrutor(a)
        </label>
        <input type="file" id="selfie" name="selfie" accept="image/*" required>
        <span class="upload-check" id="check-selfie"></span>

        <label for="comprovante" class="custom-file-label">
          <i class="fa-solid fa-upload"></i> Enviar Comprovante de Resid√™ncia
        </label>
        <input type="file" id="comprovante" name="comprovante" required>
        <span class="upload-check" id="check-comprovante"></span>

        <button type="button" onclick="voltarEtapa(2)">Voltar</button>
        <button type="button" onclick="validarEAvancar(3,4)">Pr√≥ximo</button>
      </div>

      <!-- Etapa 4: CNH, Certificado e Categorias -->
      <div class="etapa" id="etapa4" style="display:none;">
        <h4>Habilita√ß√£o e Certifica√ß√£o</h4>

        <label for="cnh" class="custom-file-label">
          <i class="fa-solid fa-upload"></i> Carteira Nacional de Habilita√ß√£o
        </label>
        <input type="file" id="cnh" name="cnh" required>
        <span class="upload-check" id="check-cnh"></span>

        <label for="certificado" class="custom-file-label">
          <i class="fa-solid fa-upload"></i> Certificado de Instrutor de Tr√¢nsito
        </label>
        <input type="file" id="certificado" name="certificado" required>
        <span class="upload-check" id="check-certificado"></span>

        <h4>Especializa√ß√µes de ensino:</h4>
        <div class="categorias">
          <label><input type="checkbox" name="categoria" value="A"> A</label>
          <label><input type="checkbox" name="categoria" value="B"> B</label>
          <label><input type="checkbox" name="categoria" value="C"> C</label>
          <label><input type="checkbox" name="categoria" value="D"> D</label>
          <label><input type="checkbox" name="categoria" value="E"> E</label>
        </div>

        <button type="button" onclick="voltarEtapa(3)">Voltar</button>
        <button type="submit">Enviar</button>

        <p style="font-size: 12px; color: #555; margin-top: 8px;">
          Ao clicar em <strong>Enviar</strong>, voc√™ concorda com os 
          <a href="/termos.html" target="_blank" style="color: orange;">Termos de Uso</a> e com a 
          <a href="/politica.html" target="_blank" style="color: orange;">Pol√≠tica de Privacidade</a>.
        </p>
      </div>
    </form>
  `;
  // ‚úî verde ap√≥s upload
  document.querySelectorAll('#formInstrutor input[type="file"]').forEach(input => {
    input.addEventListener('change', function() {
      const checkSpan = document.getElementById('check-' + this.id);
      if (this.files.length > 0) {
        checkSpan.textContent = "‚úî";
        checkSpan.style.display = "inline";
        checkSpan.style.color = "#2ecc71";
      } else {
        checkSpan.textContent = "";
        checkSpan.style.display = "none";
      }
    });
  });

  // Valida√ß√£o de etapa (inclui arquivos)
  function validarEtapa(etapaAtual) {
    const etapa = document.getElementById("etapa" + etapaAtual);
    const inputs = etapa.querySelectorAll("input, select");
    let valido = true;

    inputs.forEach(input => {
      if (input.hasAttribute("required")) {
        if (input.type === "file") {
          if (input.files.length === 0) {
            valido = false;
            input.style.border = "2px solid red";
          } else {
            input.style.border = "";
          }
        } else {
          if (!input.value) {
            valido = false;
            input.style.border = "2px solid red";
          } else {
            input.style.border = "";
          }
        }
      }
    });

    return valido;
  }

  // Avan√ßar etapa com valida√ß√£o
  window.validarEAvancar = function(etapaAtual, etapaDestino) {
    if (!validarEtapa(etapaAtual)) {
      alert("Por favor, preencha todos os campos obrigat√≥rios antes de continuar.");
      return;
    }
    document.getElementById("etapa" + etapaAtual).style.display = "none";
    document.getElementById("etapa" + etapaDestino).style.display = "block";
  }

  // Voltar etapa
  window.voltarEtapa = function(etapaDestino) {
    document.querySelectorAll(".etapa").forEach(div => div.style.display = "none");
    document.getElementById("etapa" + etapaDestino).style.display = "block";
  }

  
  
      // Inicializar selects IBGE para instrutor
      carregarEstadosInstrutor();
      document.getElementById("estadoInstrutor").addEventListener("change", carregarCidadesInstrutor);

      aplicarMascaraCPF();
      aplicarMascaraTelefone();

document.getElementById("formInstrutor").addEventListener("submit", async function(event) {
  event.preventDefault();

  const categoriasSelecionadas = [];
  document.querySelectorAll('input[name="categoria"]:checked').forEach(el => {
    categoriasSelecionadas.push(el.value);
  });

  const formData = new FormData();
  formData.append("nome", document.getElementById("nome").value);
  formData.append("email", document.getElementById("email").value);
  formData.append("cpf", document.getElementById("cpf").value);
  formData.append("sexo", document.getElementById("sexoInstrutor").value);
  formData.append("cidade", document.getElementById("cidadeInstrutor").value);

  // üîë Aqui est√° a corre√ß√£o
  const estadoSelect = document.getElementById("estadoInstrutor");
  const estadoNome = estadoSelect.options[estadoSelect.selectedIndex].text;
  formData.append("estado", estadoNome);

  formData.append("telefone", document.getElementById("telefone").value);
  formData.append("selfie", document.getElementById("selfie").files[0]);
  formData.append("comprovante", document.getElementById("comprovante").files[0]);
  formData.append("cnh", document.getElementById("cnh").files[0]);
  formData.append("certificado", document.getElementById("certificado").files[0]);
  formData.append("categorias", categoriasSelecionadas.join(","));

  try {
    const resposta = await fetch("https://meuinstrutor.onrender.com/instrutores", {
      method: "POST",
      body: formData
    });

    const resultado = await resposta.json();

    if (!resposta.ok) {
      throw new Error(resultado.error || "Erro no servidor");
    }

const modal = document.getElementById("modalSucesso");
modal.querySelector("h2").textContent = "Cadastro realizado!";
modal.querySelector("p").textContent = "Em at√© 24h entraremos em contato pelo WhatsApp para dar prosseguimento."
modal.style.display = "flex";

document.getElementById("formInstrutor").reset();
proximaEtapa(1);
    document.getElementById("formInstrutor").reset();
    proximaEtapa(1);
  } catch (error) {
    console.error("‚ùå Erro ao cadastrar instrutor:", error);
    alert("Erro ao cadastrar instrutor: " + error.message);
  }
});
}

    // Navega√ß√£o entre etapas
    function proximaEtapa(n) {
      document.querySelectorAll('.etapa').forEach(e => e.style.display = 'none');
      const etapa = document.getElementById('etapa' + n);
      etapa.style.display = 'block';
      etapa.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function voltarEtapa(n) {
      document.querySelectorAll('.etapa').forEach(e => e.style.display = 'none');
      const etapa = document.getElementById('etapa' + n);
      etapa.style.display = 'block';
      etapa.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Carregar estados/cidades para aluno
    async function carregarEstadosAluno() {
      try {
        const resp = await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados");
        const estados = await resp.json();
        const selectEstado = document.getElementById("estado");

        selectEstado.innerHTML = "<option value=''>Selecione o estado</option>";

        estados.sort((a, b) => a.nome.localeCompare(b.nome));

        estados.forEach(estado => {
          const option = document.createElement("option");
          option.value = estado.id;
          option.textContent = estado.nome;
          selectEstado.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar estados:", error);
      }
    }

    async function carregarCidadesAluno() {
      const estadoId = document.getElementById("estado").value;
      if (!estadoId) return;

      try {
        const resp = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`);
        const cidades = await resp.json();
        const selectCidade = document.getElementById("cidade");

        selectCidade.innerHTML = "<option value=''>Selecione a cidade</option>";

        cidades.sort((a, b) => a.nome.localeCompare(b.nome));

        cidades.forEach(cidade => {
          const option = document.createElement("option");
          option.value = cidade.nome;
          option.textContent = cidade.nome;
          selectCidade.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar cidades:", error);
      }
    }

    // Carregar estados/cidades para instrutor
    async function carregarEstadosInstrutor() {
      try {
        const resp = await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados");
        const estados = await resp.json();
        const selectEstado = document.getElementById("estadoInstrutor");

        selectEstado.innerHTML = "<option value=''>Selecione o estado</option>";

        estados.sort((a, b) => a.nome.localeCompare(b.nome));

        estados.forEach(estado => {
          const option = document.createElement("option");
          option.value = estado.id;
          option.textContent = estado.nome;
          selectEstado.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar estados (instrutor):", error);
      }
    }

    async function carregarCidadesInstrutor() {
      const estadoId = document.getElementById("estadoInstrutor").value;
      if (!estadoId) return;

      try {
        const resp = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`);
        const cidades = await resp.json();
        const selectCidade = document.getElementById("cidadeInstrutor");

        selectCidade.innerHTML = "<option value=''>Selecione a cidade</option>";

        cidades.sort((a, b) => a.nome.localeCompare(b.nome));

        cidades.forEach(cidade => {
          const option = document.createElement("option");
          option.value = cidade.nome;
          option.textContent = cidade.nome;
          selectCidade.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar cidades (instrutor):", error);
      }
    }

    // M√°scara de CPF
    function aplicarMascaraCPF() {
      const cpfInput = document.getElementById("cpf");
      if (!cpfInput) return;

      cpfInput.addEventListener("input", () => {
        let value = cpfInput.value.replace(/\D/g, "");
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        } else if (value.length > 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
        } else if (value.length > 3) {
          value = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
        }

        cpfInput.value = value;
      });
    }

    // Inicializa√ß√£o
    document.addEventListener("DOMContentLoaded", () => {
      carregarFormularioAluno();
      document.getElementById("btnInstrutor").addEventListener("click", carregarFormularioInstrutor);

      const toggle = document.querySelector(".menu-toggle");
      const menu = document.querySelector("nav.menu");

      toggle.addEventListener("click", (e) => {
        e.stopPropagation();
        menu.classList.toggle("active");
      });

      document.addEventListener("click", (e) => {
        if (menu.classList.contains("active") && !menu.contains(e.target) && !toggle.contains(e.target)) {
          menu.classList.remove("active");
        }
      });
    });

function aplicarMascaraTelefone() {
  const telInput = document.getElementById("telefone");
  if (!telInput) return;

  telInput.addEventListener("input", () => {
    let value = telInput.value.replace(/\D/g, ""); // s√≥ n√∫meros
    if (value.length > 11) value = value.slice(0, 11);

    if (value.length > 6) {
      value = value.replace(/(\d{2})(\d{1})(\d{4})(\d{0,4})/, "($1)$2$3-$4");
    } else if (value.length > 2) {
      value = value.replace(/(\d{2})(\d{1})(\d{0,4})/, "($1)$2$3");
    } else {
      value = value.replace(/(\d{0,2})/, "($1");
    }

    telInput.value = value;
  });
}

document.addEventListener("DOMContentLoaded", () => {
  AOS.init({
    duration: 1000, // dura√ß√£o da anima√ß√£o
    once: true      // anima s√≥ uma vez
  });
});

// adiciona evento para todos os inputs file
document.querySelectorAll('input[type="file"]').forEach(input => {
  input.addEventListener('change', function() {
    const label = document.querySelector(`label[for="${this.id}"]`);
    if (this.files.length > 0) {
      label.classList.add("uploaded"); // ativa seta verde
    } else {
      label.classList.remove("uploaded"); // remove seta se limpar
    }
  });
});

document.addEventListener("DOMContentLoaded", () => {
  const modal = document.getElementById("modal-avaliacao");
  const closeBtn = document.querySelector(".close");
  const estrelas = document.querySelectorAll(".modal-estrelas span");
  const form = document.getElementById("form-avaliacao");

  let estrelaSelecionada = 0;

  // Abrir modal ao clicar no bot√£o
  document.body.addEventListener("click", async (e) => {
    const btn = e.target.closest(".btn-avaliar");
    if (btn) {
      const instrutorId = btn.getAttribute("data-id");
      modal.setAttribute("data-instrutor-id", instrutorId);

      await carregarAvaliacoes(instrutorId); // s√≥ traz aceitas
      modal.style.display = "flex";
    }
  });

  // Fechar modal
  closeBtn.addEventListener("click", () => {
    modal.style.display = "none";
  });

  window.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.style.display = "none";
    }
  });

  // Sele√ß√£o de estrelas
  estrelas.forEach(star => {
    star.addEventListener("click", () => {
      estrelaSelecionada = parseInt(star.dataset.star);
      estrelas.forEach(s => s.classList.remove("selecionada"));
      for (let i = 0; i < estrelaSelecionada; i++) {
        estrelas[i].classList.add("selecionada");
      }
    });
  });

  // Submiss√£o do formul√°rio
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    if (estrelaSelecionada === 0) {
      alert("Selecione uma estrela antes de enviar!");
      return;
    }

    const comentario = form.querySelector("textarea").value;
    const nome = form.querySelector("input[placeholder='Primeiro nome']").value;
    const sobrenome = form.querySelector("input[placeholder='Sobrenome']").value;
    const telefone = form.querySelector("input[type=tel]").value;
    const instrutorId = modal.getAttribute("data-instrutor-id");

    try {
      const resposta = await fetch("https://meuinstrutor.onrender.com/avaliacoes", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          instrutor_id: instrutorId,
          estrelas: estrelaSelecionada,
          comentario,
          primeiro_nome: nome,
          sobrenome,
          telefone
        })
      });

if (resposta.ok) {
  document.getElementById("modalComentario").style.display = "flex";
  form.reset();
  estrelas.forEach(s => s.classList.remove("selecionada"));
  estrelaSelecionada = 0;
} else {
  document.getElementById("modalComentario").querySelector("h2").textContent = "Erro!";
  document.getElementById("modalComentario").querySelector("p").textContent = "Erro ao salvar avalia√ß√£o.";
  document.getElementById("modalComentario").style.display = "flex";
}
    } catch (err) {
      console.error(err);
      alert("Falha na conex√£o com o servidor.");
    }
  });

  // Fun√ß√£o para carregar apenas avalia√ß√µes aceitas
  async function carregarAvaliacoes(instrutorId) {
    try {
      const resposta = await fetch(`https://meuinstrutor.onrender.com/avaliacoes/${instrutorId}`);
      if (!resposta.ok) {
        const lista = document.getElementById("comentarios-lista");
        lista.innerHTML = "<p class='sem-avaliacoes'>Esse instrutor ainda n√£o recebeu nenhuma avalia√ß√£o.</p>";

        const mediaEl = document.getElementById("media-avaliacoes");
        const quantidadeEl = document.getElementById("quantidade-avaliacoes");
        if (mediaEl) mediaEl.textContent = "0.0";
        if (quantidadeEl) quantidadeEl.textContent = "0";
        return;
      }

      const avaliacoes = await resposta.json();
      const lista = document.getElementById("comentarios-lista");
      lista.innerHTML = "";

      const mediaEl = document.getElementById("media-avaliacoes");
      const quantidadeEl = document.getElementById("quantidade-avaliacoes");

      const quantidade = avaliacoes.length;
      const somaEstrelas = avaliacoes.reduce((acc, av) => acc + av.estrelas, 0);
      const media = quantidade > 0 ? (somaEstrelas / quantidade).toFixed(1) : "0.0";

      if (mediaEl) mediaEl.textContent = media;
      if (quantidadeEl) quantidadeEl.textContent = quantidade;

      avaliacoes.forEach(av => {
        const comentarioDiv = document.createElement("div");
        comentarioDiv.classList.add("comentario");

        const cabecalho = document.createElement("div");
        cabecalho.classList.add("cabecalho");

        const nome = document.createElement("span");
        nome.classList.add("nome");
        nome.textContent = `${av.primeiro_nome} ${av.sobrenome}`;

        const estrelasSpan = document.createElement("span");
        estrelasSpan.classList.add("estrelas");
        estrelasSpan.textContent = "‚òÖ".repeat(av.estrelas) + "‚òÜ".repeat(5 - av.estrelas);

        cabecalho.appendChild(nome);
        cabecalho.appendChild(estrelasSpan);

        const comentario = document.createElement("p");
        comentario.classList.add("texto");
        comentario.textContent = av.comentario;

        comentarioDiv.appendChild(cabecalho);
        comentarioDiv.appendChild(comentario);
        comentarioDiv.appendChild(document.createElement("hr"));

        lista.appendChild(comentarioDiv);
      });
    } catch (err) {
      console.error("‚ùå Erro ao carregar avalia√ß√µes:", err);
    }
  }
});
</script>

<!-- Modal de avalia√ß√µes -->
<div id="modal-avaliacao" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>
    <h2>Avalia√ß√µes do(a) Instrutor(a)</h2>

    <div id="comentarios-lista"></div>

    <h3>Deixe sua avalia√ß√£o</h3>
    <div class="modal-estrelas">
      <span data-star="1">‚òÖ</span>
      <span data-star="2">‚òÖ</span>
      <span data-star="3">‚òÖ</span>
      <span data-star="4">‚òÖ</span>
      <span data-star="5">‚òÖ</span>
    </div>

    <form id="form-avaliacao" class="modal-form">
      <textarea id="comentario" class="modal-input modal-textarea" required placeholder="Seu feedback ajuda outros alunos" rows="3" maxlength="100"></textarea>
      <p id="aviso" style="color:red; font-weight:bold;"></p>

      <input type="text" id="primeiro_nome" class="modal-input" required placeholder="Primeiro nome" />
      <input type="text" id="sobrenome" class="modal-input" required placeholder="Sobrenome" />
      <input type="tel" id="telefone" class="modal-input" required placeholder="Telefone WhatsApp" />
      <button type="submit" class="modal-button">Enviar Avalia√ß√£o</button>
    </form>
  </div>
</div>

<script>
document.getElementById("comentario").addEventListener("input", e => {
  const linhas = e.target.value.split(/\r?\n/).length;
  if (linhas > 3) {
    document.getElementById("aviso").textContent = "M√°ximo de 3 linhas permitido.";
    e.target.value = e.target.value.split(/\r?\n/).slice(0,3).join("\n");
  } else {
    document.getElementById("aviso").textContent = "";
  }
});
</script>

<!-- Modal -->
<div id="modalComentario" class="modal">
  <div class="modal-conteudo">
    <span class="fechar">&times;</span>
    <div class="icone-relogio">
      <!-- √çcone SVG de rel√≥gio -->
      <svg xmlns="http://www.w3.org/2000/svg" width="60" height="60" fill="orange" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" stroke="orange" stroke-width="2" fill="none"/>
        <line x1="12" y1="12" x2="12" y2="7" stroke="orange" stroke-width="2" stroke-linecap="round"/>
        <line x1="12" y1="12" x2="16" y2="12" stroke="orange" stroke-width="2" stroke-linecap="round"/>
      </svg>
    </div>
    <h2>Coment√°rio enviado!</h2>
    <p>Seu coment√°rio foi levado para an√°lise e em at√© 24 horas ser√° revisado e postado.</p>
  </div>
</div>

<script>
  // Fechar modal de coment√°rio
// Fechar modal
document.querySelector("#modalComentario .fechar").addEventListener("click", () => {
  document.getElementById("modalComentario").style.display = "none";
});

// Fechar ao clicar fora
window.addEventListener("click", (e) => {
  const modal = document.getElementById("modalComentario");
  if (e.target === modal) {
    modal.style.display = "none";
  }
});
</script>

<!-- Modal de sucesso -->
<div id="modalSucesso" class="modal">
  <div class="modal-conteudo">
    <span class="fechar">&times;</span>
    <div class="icone-check">
      <!-- SVG de check verde redondo -->
      <svg xmlns="http://www.w3.org/2000/svg" width="70" height="70" viewBox="0 0 24 24">
        <circle cx="12" cy="12" r="10" fill="#2ecc71"/>
        <path d="M9 12l2 2l4-4" stroke="#fff" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <h2>Cadastro realizado!</h2>
    <p>Em at√© 24h uma equipe entrar√° em contato pelo WhatsApp para dar prosseguimento.</p>
  </div>
</div>
 
<script>
document.querySelector("#modalSucesso .fechar").addEventListener("click", () => {
  document.getElementById("modalSucesso").style.display = "none";
});

// Fechar ao clicar fora
window.addEventListener("click", (e) => {
  const modal = document.getElementById("modalSucesso");
  if (e.target === modal) {
    modal.style.display = "none";
  }
});
</script>

</body>
</html>