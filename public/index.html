<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Instrutor Pro</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Cabeçalho -->
  <header class="topo">
    <div class="logo">
      <img src="logo.png" alt="Instrutor Pro" />
      <span>Instrutor Pro</span>
    </div>
    <button class="menu-toggle">☰</button>
    <nav class="menu">
      <a href="index.html">Início</a>
      <a href="sobre.html">Sobre nós</a>
      <a href="contato.html">Fale Conosco</a>
      <button class="btn amarelo" id="btnInstrutor">Sou Instrutor</button>
    </nav> 
  </header>

  <!-- Seção principal -->
  <section class="fundo-busca">
    <div class="imagem"></div>
    <div class="formulario">
      <h2 id="titulo-form">Buscar Instrutor</h2>
      <div id="form-area"></div>
    </div>
  </section>

  <!-- Rodapé -->
  <footer>
    © 2025 Instrutor Pro - Todos os direitos reservados
  </footer>

  <!-- Script -->
  <script>
    // Formulário de aluno
    function carregarFormularioAluno() {
      document.getElementById("titulo-form").innerText = "Buscar Instrutor";
      document.getElementById("form-area").innerHTML = `
        <form onsubmit="buscarInstrutor(event)">
          <div class="linha-horizontal">
            <div class="campo">
              <label for="estado">Estado:</label>
              <select id="estado" required>
                <option value="">Selecione o estado</option>
              </select>
            </div>
            <div class="campo">
              <label for="cidade">Cidade:</label>
              <select id="cidade" required>
                <option value="">Selecione a cidade</option>
              </select>
            </div>
          </div>
          <div class="linha-horizontal">
            <div class="campo">
              <label for="categoria">Categoria CNH:</label>
              <select id="categoria" required>
                <option value="">Selecione a categoria</option>
                <option value="ACC">ACC</option>
                <option value="A">A</option>
                <option value="B">B</option>
                <option value="C">C</option>
                <option value="D">D</option>
                <option value="E">E</option>
              </select>
            </div>
            <div class="campo">
              <label for="sexo">Sexo:</label>
              <select id="sexo" required>
                <option value="">Selecione</option>
                <option value="Feminino">Feminino</option>
                <option value="Masculino">Masculino</option>
                <option value="Sem preferencia">Sem preferência</option>
              </select>
            </div>
          </div>
          <button type="submit">Buscar</button>
        </form>
        <div id="resultado"></div>
      `;

      carregarEstadosAluno();
      document.getElementById("estado").addEventListener("change", carregarCidadesAluno);
    }

    async function buscarInstrutor(event) {
      event.preventDefault();
      const estado = document.getElementById("estado").selectedOptions[0].text;
      const cidade = document.getElementById("cidade").value;
      const categoria = document.getElementById("categoria").value;
      const sexo = document.getElementById("sexo").value;

      try {
        const resposta = await fetch(`https://meuinstrutor.onrender.com/instrutores/aceitos?cidade=${cidade}&estado=${estado}`);
        const instrutores = await resposta.json();

        let html = `<h4>Instrutores disponíveis em ${cidade}/${estado}:</h4>`;
        html += `<p>Filtro aplicado: Categoria ${categoria}, Sexo ${sexo}</p>`;
        html += "<ul>";

        instrutores.forEach(instrutor => {
          html += `<li><strong>${instrutor.nome}</strong> - Categoria ${instrutor.categorias}, Endereço: ${instrutor.endereco}</li>`;
        });

        html += "</ul>";
        document.getElementById("resultado").innerHTML = html;
      } catch (error) {
        console.error("Erro ao buscar instrutores:", error);
        document.getElementById("resultado").innerHTML = "<p>Erro ao buscar instrutores.</p>";
      }
    }

    // Formulário de instrutor
    function carregarFormularioInstrutor() {
      document.getElementById("titulo-form").innerText = "Cadastro de Instrutor";
      document.getElementById("form-area").innerHTML = `
        <form id="formInstrutor">
<div class="etapa" id="etapa1">
  <label>Nome completo:</label>
  <input type="text" id="nome" required>

  <label>CPF:</label>
  <input type="text" id="cpf" maxlength="14" required>

  <label>Sexo:</label>
  <select id="sexoInstrutor" required>
    <option value="">Selecione</option>
    <option value="M">Masculino</option>
    <option value="F">Feminino</option>
  </select>

  <!-- Novo campo de telefone -->
<label>Telefone:</label>
<input 
  type="tel" 
  id="telefone" 
  placeholder="(99)91234-5678" 
  required 
  pattern="\(\d{2}\)9\d{4}-\d{4}" 
  title="Formato esperado: (XX)9XXXX-XXXX">

  <button type="button" onclick="proximaEtapa(2)">Próximo</button>
</div>

          <div class="etapa" id="etapa2" style="display:none;">
            <h4>Endereço</h4>
            <label>CEP:</label>
            <input type="text" id="cep" required>
            <label>Rua:</label>
            <input type="text" id="rua" required>
            <label>Número:</label>
            <input type="text" id="numero" required>
            <label>Bairro:</label>
            <input type="text" id="bairro" required>

            <label>Estado:</label>
            <select id="estadoInstrutor" required>
              <option value="">Selecione o estado</option>
            </select>

            <label>Cidade:</label>
            <select id="cidadeInstrutor" required>
              <option value="">Selecione a cidade</option>
            </select>

            <button type="button" onclick="voltarEtapa(1)">Voltar</button>
            <button type="button" onclick="proximaEtapa(3)">Próximo</button>
          </div>

          <div class="etapa" id="etapa3" style="display:none;">
            <h4>Documentos</h4>
            <label>Comprovante de residência:</label>
            <input type="file" id="comprovante" name="comprovante" required>
            <label>CNH (obrigatória):</label>
            <input type="file" id="cnh" name="cnh" required>

            <h4>Categorias que sabe ensinar:</h4>
<div class="categorias">
  <label><input type="checkbox" name="categoria" value="A" required> A</label>
  <label><input type="checkbox" name="categoria" value="B"> B</label>
  <label><input type="checkbox" name="categoria" value="C"> C</label>
  <label><input type="checkbox" name="categoria" value="D"> D</label>
  <label><input type="checkbox" name="categoria" value="E"> E</label>
</div>

            <button type="button" onclick="voltarEtapa(2)">Voltar</button>
            <button type="submit">Enviar</button>
          </div>
        </form>
      `;

      // Inicializar selects IBGE para instrutor
      carregarEstadosInstrutor();
      document.getElementById("estadoInstrutor").addEventListener("change", carregarCidadesInstrutor);

      aplicarMascaraCPF();
      aplicarMascaraTelefone();

      document.getElementById("formInstrutor").addEventListener("submit", async function(event) {
        event.preventDefault();

        const categoriasSelecionadas = [];
        document.querySelectorAll('input[name="categoria"]:checked').forEach(el => {
          categoriasSelecionadas.push(el.value);
        });

        const formData = new FormData();
        formData.append("nome", document.getElementById("nome").value);
        formData.append("cpf", document.getElementById("cpf").value);
        formData.append("sexo", document.getElementById("sexoInstrutor").value);
        formData.append("endereco", document.getElementById("rua").value + ", " + document.getElementById("numero").value);
        formData.append("cidade", document.getElementById("cidadeInstrutor").value);
        formData.append("estado", document.getElementById("estadoInstrutor").selectedOptions[0].text);
        formData.append("telefone", document.getElementById("telefone").value);
        formData.append("comprovante", document.getElementById("comprovante").files[0]);
        formData.append("cnh", document.getElementById("cnh").files[0]);
        formData.append("categorias", categoriasSelecionadas.join(","));

        try {
          console.log("Disparando fetch...");
          const resposta = await fetch("https://meuinstrutor.onrender.com/instrutores", {
            method: "POST",
            body: formData
          });

          if (!resposta.ok) {
            throw new Error("Erro no servidor: " + resposta.status);
          }

          const resultado = await resposta.json();
          alert(resultado.message);
          document.getElementById("formInstrutor").reset();
          proximaEtapa(1); // volta para a primeira etapa
        } catch (error) {
          console.error("Erro ao cadastrar instrutor:", error);
          alert("Erro ao cadastrar instrutor. Verifique se o servidor está rodando e a tabela existe.");
        }
      });
    }

    // Navegação entre etapas
    function proximaEtapa(n) {
      document.querySelectorAll('.etapa').forEach(e => e.style.display = 'none');
      const etapa = document.getElementById('etapa' + n);
      etapa.style.display = 'block';
      etapa.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function voltarEtapa(n) {
      document.querySelectorAll('.etapa').forEach(e => e.style.display = 'none');
      const etapa = document.getElementById('etapa' + n);
      etapa.style.display = 'block';
      etapa.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    // Carregar estados/cidades para aluno
    async function carregarEstadosAluno() {
      try {
        const resp = await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados");
        const estados = await resp.json();
        const selectEstado = document.getElementById("estado");

        selectEstado.innerHTML = "<option value=''>Selecione o estado</option>";

        estados.sort((a, b) => a.nome.localeCompare(b.nome));

        estados.forEach(estado => {
          const option = document.createElement("option");
          option.value = estado.id;
          option.textContent = estado.nome;
          selectEstado.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar estados:", error);
      }
    }

    async function carregarCidadesAluno() {
      const estadoId = document.getElementById("estado").value;
      if (!estadoId) return;

      try {
        const resp = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`);
        const cidades = await resp.json();
        const selectCidade = document.getElementById("cidade");

        selectCidade.innerHTML = "<option value=''>Selecione a cidade</option>";

        cidades.sort((a, b) => a.nome.localeCompare(b.nome));

        cidades.forEach(cidade => {
          const option = document.createElement("option");
          option.value = cidade.nome;
          option.textContent = cidade.nome;
          selectCidade.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar cidades:", error);
      }
    }

    // Carregar estados/cidades para instrutor
    async function carregarEstadosInstrutor() {
      try {
        const resp = await fetch("https://servicodados.ibge.gov.br/api/v1/localidades/estados");
        const estados = await resp.json();
        const selectEstado = document.getElementById("estadoInstrutor");

        selectEstado.innerHTML = "<option value=''>Selecione o estado</option>";

        estados.sort((a, b) => a.nome.localeCompare(b.nome));

        estados.forEach(estado => {
          const option = document.createElement("option");
          option.value = estado.id;
          option.textContent = estado.nome;
          selectEstado.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar estados (instrutor):", error);
      }
    }

    async function carregarCidadesInstrutor() {
      const estadoId = document.getElementById("estadoInstrutor").value;
      if (!estadoId) return;

      try {
        const resp = await fetch(`https://servicodados.ibge.gov.br/api/v1/localidades/estados/${estadoId}/municipios`);
        const cidades = await resp.json();
        const selectCidade = document.getElementById("cidadeInstrutor");

        selectCidade.innerHTML = "<option value=''>Selecione a cidade</option>";

        cidades.sort((a, b) => a.nome.localeCompare(b.nome));

        cidades.forEach(cidade => {
          const option = document.createElement("option");
          option.value = cidade.nome;
          option.textContent = cidade.nome;
          selectCidade.appendChild(option);
        });
      } catch (error) {
        console.error("Erro ao carregar cidades (instrutor):", error);
      }
    }

    // Máscara de CPF
    function aplicarMascaraCPF() {
      const cpfInput = document.getElementById("cpf");
      if (!cpfInput) return;

      cpfInput.addEventListener("input", () => {
        let value = cpfInput.value.replace(/\D/g, "");
        if (value.length > 11) value = value.slice(0, 11);

        if (value.length > 9) {
          value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, "$1.$2.$3-$4");
        } else if (value.length > 6) {
          value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, "$1.$2.$3");
        } else if (value.length > 3) {
          value = value.replace(/(\d{3})(\d{1,3})/, "$1.$2");
        }

        cpfInput.value = value;
      });
    }

    // Inicialização
    document.addEventListener("DOMContentLoaded", () => {
      carregarFormularioAluno();
      document.getElementById("btnInstrutor").addEventListener("click", carregarFormularioInstrutor);

      const toggle = document.querySelector(".menu-toggle");
      const menu = document.querySelector("nav.menu");

      toggle.addEventListener("click", (e) => {
        e.stopPropagation();
        menu.classList.toggle("active");
      });

      document.addEventListener("click", (e) => {
        if (menu.classList.contains("active") && !menu.contains(e.target) && !toggle.contains(e.target)) {
          menu.classList.remove("active");
        }
      });
    });

function aplicarMascaraTelefone() {
  const telInput = document.getElementById("telefone");
  if (!telInput) return;

  telInput.addEventListener("input", () => {
    let value = telInput.value.replace(/\D/g, ""); // só números
    if (value.length > 11) value = value.slice(0, 11);

    if (value.length > 6) {
      value = value.replace(/(\d{2})(\d{1})(\d{4})(\d{0,4})/, "($1)$2$3-$4");
    } else if (value.length > 2) {
      value = value.replace(/(\d{2})(\d{1})(\d{0,4})/, "($1)$2$3");
    } else {
      value = value.replace(/(\d{0,2})/, "($1");
    }

    telInput.value = value;
  });
}

  </script>
</body>
</html>